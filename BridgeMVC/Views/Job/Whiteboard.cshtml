@model IEnumerable<BridgeMVC.Models.Job>
@{
    string UserSignature = (string)Session["UserSignature"];
    string bridgeModule = (string)Session["BridgeModule"];
    //string SF = (string)Session["SendingFlag"];
    var BFlist = (IEnumerable<BridgeMVC.Models.BFinancial>)ViewBag.LCertType;
    //var LCertAction = ViewBag.LCertAction;
    //var LMainProdType = ViewBag.LMainProdType;
    //var LSubProdType = ViewBag.LSubProdType;
    var LUser = ViewBag.LUser;
    string wbt = ViewBag.WBT;

    ViewBag.Title = "Whiteboard";
    var users = ViewBag.users;

    var sn = 0;
    string getColorCode(string ct)
    {
        string c = "";
        foreach (BridgeMVC.Models.BFinancial bf in BFlist)
        {
            if (bf.CertType == ct)
            {
                c = bf.ColorCode;
            }
        }

        return c;
    }




}
<script>

    function getProdDesc(id) {
        $.ajax(
            {
                type: 'GET',
                url: '/Job/GetProdDesc',
                data: { id: id },

                success: function (data) {
                    $("#proddesc" + id).html(data);
                    //console.log(data);
                },
                error: function (e) {
                    alert('Error: ' + e);
                    return "";
                }
            });
    }
</script>
<style>
    table tr:hover td {
       
        color: black;
    }

    #people {

    
        position: fixed;
        bottom: 3%;
        width: 100%;

        opacity: 1;
    }



    .userImage {
        padding: 6px;
    }



    .dropBox {
        width: 72px;
        height: 72px;
        padding: 0px;
        border: 1px solid #aaaaaa;
    }

    .jobCard {
        box-shadow: 5px 10px 8px #888888;
        margin:12px;
    }



    .wbTab {
        /*width: 450px;*/
        padding: 0.5em 1em 0.5em 1em;
        min-width: 300px;
        font-weight: bold;
        height: 100px;
        float: left;
        margin-right: 1em;
    }

        .wbTab:hover {
            background-color: #eee;
            cursor: pointer;
            color: black;
        }

    .wbnav {
        overflow: hidden;
        background-color: white;
    }

        .wbnav a {
            float: left;
            display: block;
            color: black;
            text-align: center;
            padding: 14px 36px;
            text-decoration: none;
            font-size: 17px;
        }

            .wbnav a:hover {
                background-color: #ddd;
                color: black;
            }

    .active {
        background-color: #4CAF50;
        color: white;
    }

    .wbnav .icon {
        display: none;
    }





    div.header {
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        font-size: 40px;
    }

    div.container {
        padding: 10px;
    }

    .btn {
        color: lightgrey;
    }
</style>

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "tabFilter" }))
{


    <table>
        <colgroup>
            <col span="1" style="width: 17%;">
            <col span="1" style="width: 12%;">
            <col span="1" style="width: 12%;">
            <col span="1" style="width: 17%;">
            <col span="1" style="width: 21%;">
            <col span="1" style="width: 21%;">
        </colgroup>
        <tr>
            <td hidden>
                @Html.TextBox("wbTab", null, new { @class = "form-control" })   @Html.TextBox("wbTaskHandler", null, new { @class = "form-control" })
            </td>
            <td>
                <input id="wb_dist" value="TO BE DISTRIBUTED" class="btn" readonly />
            </td>
            <td>
                <input id="wb_oh" value="ON HOLD" class="btn" readonly />
            </td>
            <td>
                <input id="wb_og" value="ON GOING" class="btn" readonly />
            </td>
            <td>
                <input id="wb_v" value="UNDER VERIFICATION" class="btn" readonly />
            </td>
            <td>
                <input id="wb_done" style="width:300px;" value="COMPLETED LAST WEEK" class="btn" readonly />
            </td>
        </tr>
    </table>


}


<br>


@*<h3>Due in 5 days</h3>*@

@foreach (var item in Model)
{
    //sn += 1;
    string proddesc = "proddesc" + item.Id;
    string ctcolor = getColorCode(item.CertType);
    string raePicSrc = "/Content/pictures/M2Profiles/" + item.RAE + ".png";

    <table style="table-layout:fixed; width:auto;background-color:@ctcolor" class="jobCard col-lg-3">
        <colgroup>
            <col style="width:360px" />
            <col style="width:180px" />
        </colgroup>
        <tbody>
            <tr style="height:180px">
                <td>
                    @Html.DisplayFor(modelItem => item.NpsJobId)
                    <br />
                    <p class="h2" id="@proddesc"></p>
                    <script>getProdDesc("@item.Id")</script>

                    <br /> Budget:
                    @Html.DisplayFor(modelItem => item.BudgetHour) hours
                    <br />
                    @*@Html.DisplayFor(modelItem => item.TaskHandler)*@
                </td>
                <td class="dropBox" ondrop="drop(event)" ondragover="allowDrop(event)" id="@item.Id">
                    <img class="userImage" id="WHITEBOARD_X" src="@raePicSrc" draggable="true" ondragstart="drag(event)" width="180" height="180">

                </td>
            </tr>
        </tbody>
    </table>



}


<br /><br /><br />


<div id="people">
    <hr />
    <img class="userImage" id="WHITEBOARD" src="~/Content/pictures/M2Profiles/WHITEBOARD.png" draggable="true" ondragstart="drag(event)" width="180" height="180">

</div>





<script>

    var newNodeId = 0;
    var item2 = document.getElementById("people");
    var cln = document.getElementById("people");

    var users = ["KERE", "BAY", "HDR", "JPOUL", "MAKV", "MASP", "MOMOH", "RATSI", "ROME", "SADEL", "SINSE", "TWOE", "VIDI", "VMRR", "ZEINA"];

    var ima = document.getElementById("WHITEBOARD");


    for (var i = 0, j = users.length; i < j; i++) {
    var imacln = ima.cloneNode(true);
    imacln.id = users[i];
    imacln.src = "/Content/pictures/M2Profiles/" + users[i] + ".png";
    item2.appendChild(imacln);
    }




    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        newNodeId = newNodeId + 1;
        var item = document.getElementById(ev.target.id);
        cln = item.cloneNode(true);
        cln.id = ev.target.id + "__" + newNodeId;
    }

    function drop(ev) {
        var dropobj = document.getElementById(ev.target.id);
        if (dropobj.className != "dropBox") {
            dropobj = dropobj.parentNode;
        }


        while (dropobj.firstChild) {
            dropobj.removeChild(dropobj.firstChild);
        }

        item2.appendChild(cln);
        ev.preventDefault();
        dropobj.appendChild(cln);
        cln.draggable = false;

        console.log(dropobj.id);
        var myStr = cln.outerHTML;
        var subStr = myStr.match("id=\"(.*)__");

        $.ajax(
            {
                type: 'GET',
                url: '/Job/ChangeJobRAE',
                data: { id: dropobj.id, newRAE: subStr[1] },

                success: function (data) {
                   
                    console.log(data);
                },
                error: function (e) {
                    alert('Error: ' + e);
                    
                }
            });


    }


    var jobdbid = "";
    var newHandler = "";
    var bm = "@bridgeModule";
    var wbt = "@wbt";

    var LUser = @Html.Raw(Json.Encode(LUser));



    // Close the dropdown if the user clicks outside of it


    $('#wb_dist').on('click', function (event) {

        $('#wbTab').val("wb_dist");
        $('#tabFilter').submit();
    })
    $('#wb_oh').on('click', function (event) {

        $('#wbTab').val("wb_oh");
        $('#tabFilter').submit();
    })
    $('#wb_og').on('click', function (event) {

        $('#wbTab').val("wb_og");
        $('#tabFilter').submit();
    })
    $('#wb_v').on('click', function (event) {

        $('#wbTab').val("wb_v");
        $('#tabFilter').submit();
    })
    $('#wb_done').on('click', function (event) {

        $('#wbTab').val("wb_done");
        $('#tabFilter').submit();
    })


    if (wbt != null && wbt != "") {
        document.getElementById(wbt).style.backgroundColor = "lightblue";
        document.getElementById(wbt).style.color = "black";
    }


</script>